
<div class="container">

   <div class="row epitaph">
      <div class="col-xs-12">
            <h1><%= "#{@memorial.first_name} #{@memorial.last_name}" %></h1>
            <h2 title="<%= "#{@memorial.dob.to_formatted_s(:long_ordinal)} - #{@memorial.dod.to_formatted_s(:long_ordinal)}" %>"><%= "#{@memorial.dob.year} - #{@memorial.dod.year}" %></h2>
      </div>
   </div>

   <div class="tombstone">

   </div>

   <div class="posts-forms row">
      <% if current_user %>
            <button type="button" class="btn btn-primary btn-lg texts-button" data-toggle="modal" data-target="#myModal">
              <span class="glyphicon glyphicon-pencil" aria-hidden="true"></span> Write a Message
            </button>
            <button type="button" class="btn btn-primary btn-lg pictures-button" data-toggle="modal" data-target="#myModal">
              <span class="glyphicon glyphicon-picture" aria-hidden="true"></span> Leave a Picture
            </button>
            <button type="button" class="btn btn-primary btn-lg videos-button" data-toggle="modal" data-target="#myModal">
              <span class="glyphicon glyphicon-film" aria-hidden="true"></span> Share a Video
            </button>
      <% else %>
            <%= link_to "Sign Up", signup_path, class: "btn btn-primary btn-lg" %>
            <%= link_to "Log In", login_path, class: "btn btn-primary btn-lg" %>
      <% end %>
   </div>

   <div class="posts row">
      <% @memorial.posts.each do |post| %>
         <% if post.postable_type == "Text" %>
            <div class="col-xs-12 col-sm-6 col-md-4 post">
               <div class="panel panel-default">
                 <div class="panel-body">
                   <%= post.postable.try(:body) %>
                 </div>
                 <div class="panel-footer">Shared by: <%= post.user %></div>
               </div>
            </div>
         <% elsif post.postable_type == "Picture" %>
            <div class="col-xs-12 col-sm-6 col-md-4 post">
               <div class="panel panel-default">
                 <div class="panel-body">
                   <%= image_tag post.postable.image.feed.url %>
                 </div>
                 <div class="panel-footer">Shared by: <%= post.user %></div>
               </div>
            </div>
         <% elsif post.postable_type == "Video" %>
            <div class="col-xs-12 col-sm-6 col-md-4 post">
               <div class="panel panel-default">
                  <div id="videos-thumbnail" class="panel-body">
                        <%= video_tag post.postable.video_file.url, controls: true, size: "300x300" %>
                  </div>
                  <div class="panel-footer">Shared by: <%= post.user %></div>
               </div>
            </div>
         <% end %>
      <% end %>
   </div>


   <!-- Modal -->
   <div class="modal fade" id="myModal" tabindex="-1" role="dialog" aria-labelledby="myModalLabel">
     <div class="modal-dialog" role="document">
       <div class="modal-content">

         <%= form_for :text, url: texts_path do |f| %>
            <div class="modal-header texts-form">
              <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
              <h4 class="modal-title" id="myModalLabel">Write a Message</h4>
            </div>
            <div class="modal-body texts-form">
                  <p><%= f.text_area :body, class: "text-area" %></p><br>
                  <p><%= f.hidden_field :memorial_id, value: @memorial.id %></p>
            </div>
            <div class="modal-footer texts-form">
                 <button type="button" class="btn btn-default" data-dismiss="modal">Close</button>
                 <%= f.submit "Share Message", class: "btn btn-primary"%>
            </div>
         <% end %>

         <%= form_for Picture.new do |f| %>
            <div class="modal-header pictures-form">
              <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
              <h4 class="modal-title" id="myModalLabel">Leave a Picture</h4>
            </div>
            <div class="modal-body pictures-form">
                  <p><%= f.file_field :image %></p>
                  <p><%= f.hidden_field :memorial_id, value: @memorial.id %></p>
            </div>
            <div class="modal-footer pictures-form">
                 <button type="button" class="btn btn-default" data-dismiss="modal">Close</button>
                 <%= f.submit "Share Picture", class: "btn btn-primary"%>
           </div>
        <% end %>

        <%= form_for Video.new do |f| %>
           <div class="modal-header videos-form">
             <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
             <h4 class="modal-title" id="myModalLabel">Share a Video</h4>
           </div>
           <div class="modal-body videos-form">
                <p><%= f.file_field :video_file %></p>
                <p><%= f.hidden_field :memorial_id, value: @memorial.id %></p>
           </div>
           <div class="modal-footer videos-form">
                <button type="button" class="btn btn-default" data-dismiss="modal">Close</button>
                <%= f.submit "Share Video", class: "btn btn-primary"%>
          </div>
       <% end %>

       </div>
     </div>
   </div>

</div>

<script>

   $(document).ready(function() {
      var pictureUrl = [
         <% @pics.each do |pic| %>
            <% if pic == @pics.last %>
               "<%= pic.image.url %>"
            <% else %>
               "<%= pic.image.url %>",
            <% end %>
         <% end %>
      ];

      $(".tombstone").css("background-image", "url(" + pictureUrl[0] + ")");
      var length = pictureUrl.length
      var i = length - 1
      setInterval(function() {
         if (i == 0) {
            $(".tombstone").css("background-image", "url(" + pictureUrl[i] + ")");
            i = length - 1
         } else {
            $(".tombstone").css("background-image", "url(" + pictureUrl[i] + ")");
            i = i - 1
         };
      }, 4000);

   });

   // setTimeout(function() {
   //    $(".activeSlide").animate({"opacity": "0"}, 1000);
   //    active.removeClass("activeSlide");
   //    next.addClass("activeSlide");
   // }, 4000);

</script>
