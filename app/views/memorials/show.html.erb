
<div class="container">

   <div class="row epitaph">
      <div class="col-xs-12">
            <h1><%= "#{@memorial.first_name} #{@memorial.last_name}" %></h1>
            <h2 title="<%= "#{@memorial.dob.to_formatted_s(:long_ordinal)} - #{@memorial.dod.to_formatted_s(:long_ordinal)}" %>"><%= "#{@memorial.dob.year} - #{@memorial.dod.year}" %></h2>
      </div>
   </div>

   <div class="tombstone"></div>

</div>

<div id="bio">
  <div class="container">
    <p class="bio"><%= @memorial.try(:bio) %></p>
  </div>
</div>

   <div class="posts-forms">
        <% if current_user %>
              <button class="posts-form-button texts-button" data-toggle="modal" data-target="#myModal">
                <span class="glyphicon glyphicon-pencil" aria-hidden="true"></span> Message
              </button>
              <button class="posts-form-button pictures-button" data-toggle="modal" data-target="#myModal">
                <span class="glyphicon glyphicon-picture" aria-hidden="true"></span> Picture
              </button>
              <button class="posts-form-button videos-button" data-toggle="modal" data-target="#myModal">
                <span class="glyphicon glyphicon-film" aria-hidden="true"></span> Video
              </button>
        <% else %>
              <button class="posts-form-button"><%= link_to "Sign Up", signup_path, class: "rails-link" %></button>
              <button class="posts-form-button"><%= link_to "Log In", login_path, class: "rails-link" %></button>
        <% end %>
   </div>

   <!-- Modal -->
   <div class="modal fade" id="myModal" tabindex="-1" role="dialog" aria-labelledby="myModalLabel">
     <div class="modal-dialog" role="document">
       <div class="modal-content">

         <%= form_for :text, url: texts_path do |f| %>
            <div class="modal-header texts-form">
              <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
              <h4 class="modal-title" id="myModalLabel">Write a Message</h4>
            </div>
            <div class="modal-body texts-form">
                  <p><%= f.text_area :body, class: "text-area" %></p><br>
                  <p><%= f.hidden_field :memorial_id, value: @memorial.id %></p>
            </div>
            <div class="modal-footer texts-form">
                 <button type="button" class="btn btn-default" data-dismiss="modal">Close</button>
                 <%= f.submit "Share Message", class: "btn btn-primary"%>
            </div>
         <% end %>

         <%= form_for Picture.new do |f| %>
            <div class="modal-header pictures-form">
              <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
              <h4 class="modal-title" id="myModalLabel">Leave a Picture</h4>
            </div>
            <div class="modal-body pictures-form">
                  <p><%= f.file_field :image %></p>
                  <p><%= f.text_area :body %></p>
                  <p><%= f.hidden_field :memorial_id, value: @memorial.id %></p>
            </div>
            <div class="modal-footer pictures-form">
                 <button type="button" class="btn btn-default" data-dismiss="modal">Close</button>
                 <%= f.submit "Share Picture", class: "btn btn-primary"%>
           </div>
        <% end %>

        <%= form_for Video.new do |f| %>
           <div class="modal-header videos-form">
             <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
             <h4 class="modal-title" id="myModalLabel">Share a Video</h4>
           </div>
           <div class="modal-body videos-form">
                <p><%= f.file_field :video_file %></p>
                <p><%= f.text_area :body %></p>
                <p><%= f.hidden_field :memorial_id, value: @memorial.id %></p>
           </div>
           <div class="modal-footer videos-form">
                <button type="button" class="btn btn-default" data-dismiss="modal">Close</button>
                <%= f.submit "Share Video", class: "btn btn-primary"%>
          </div>
       <% end %>


       </div>
     </div>
   </div>


<div class="masonry-container posts">
   <div class="grid">
      <% @memorial.posts.reverse.each do |post| %>
         <% if post.postable_type == "Text" %>
            <div class="grid-sizer"></div>
            <div class="grid-item">
              <div class="post">
                <div class="txt">
                   <p class="body"><%= post.postable.try(:body) %></p>
                 </div>
                 <p class="timestamp"><%= "Posted by: #{post.user.full_name} on #{post.created_at.strftime("%m-%d-%Y")}" %></p>
                 <% if current_user != nil && (post.user == current_user || current_user.role == 'admin') %>
                   <button class="edit-post-button edit-texts-button" data-toggle="modal" data-target="#myModal">
                     <%= link_to "Edit", edit_text_path(post.postable), remote: true, class: "rails-link" %></span>
                   </button>
                 <% end %>
              </div>
            </div>
            <!-- <div class="grid-item grid-item--width2"></div>
            <div class="grid-item grid-item--height2"></div> -->
         <% elsif post.postable_type == "Picture" %>
            <div class="grid-sizer"></div>
            <div class="grid-item">
              <div class="post">
                   <%= image_tag post.postable.image.feed.url, :class => "pic" %>
                   <div>
                     <% unless post.postable.body == nil || post.postable.body.empty? == true %>
                      <p class="body"><%= post.postable.body %></p>
                     <% end %>
                   </div>
                   <p class="timestamp"><%= "Posted by: #{post.user.full_name} on #{post.created_at.strftime("%m-%d-%Y")}"%></p>
                   <% if current_user != nil && (post.user == current_user || current_user.role == 'admin') %>
                     <button class="edit-post-button edit-picture-button" data-toggle="modal" data-target="#myModal">
                       <%= link_to "Edit", edit_picture_path(post.postable), class: "rails-link" %></span>
                     </button>
                   <% end %>
              </div>
            </div>
            <!-- <div class="grid-item grid-item--width2"></div>
            <div class="grid-item grid-item--height2"></div> -->
         <% elsif post.postable_type == "Video" %>
            <div class="grid-sizer"></div>
            <div class="grid-item">
              <div class="post">
                   <%= video_tag post.postable.video_file.url, controls: true, :class => "vid" %>
                   <div>
                     <% unless post.postable.body == nil || post.postable.body.empty? == true %>
                      <p class="body"><%= post.postable.body %></p>
                     <% end %>
                   </div>
                   <p class="timestamp"><%= "Posted by: #{post.user.full_name} on #{post.created_at.strftime("%m-%d-%Y")}" %></p>
                   <% if current_user != nil && (post.user == current_user || current_user.role == 'admin') %>
                     <button class="edit-post-button edit-video-button" data-toggle="modal" data-target="#myModal">
                       <%= link_to "Edit", edit_video_path(post.postable), class: "rails-link" %></span>
                     </button>
                   <% end %>
              </div>
            </div>
            <!-- <div class="grid-item grid-item--width2"></div>
            <div class="grid-item grid-item--height2"></div> -->
         <% end %>
      <% end %>
   </div>
</div>
   <!-- End of Masonry Grid -->

<script>

   $(document).ready(function() {

        var pictureUrl = [
           <% @pics.each do |pic| %>
              <% if pic == @pics.last %>
                 "<%= pic.image.url %>"
              <% else %>
                 "<%= pic.image.url %>",
              <% end %>
           <% end %>
        ];

        $(".tombstone").css("background-image", "url(" + pictureUrl[0] + ")");
        var length = pictureUrl.length
        var i = length - 1
        setInterval(function() {
           if (i == 0) {
              $(".tombstone").css("background-image", "url(" + pictureUrl[i] + ")");
              i = length - 1
           } else {
              $(".tombstone").css("background-image", "url(" + pictureUrl[i] + ")");
              i = i - 1
           };
        }, 4000);

      setTimeout(function() {
        var $grid = $('.grid').masonry({ });
           $grid.masonry({
             itemSelector: '.grid-item',
             columnWidth: '.grid-sizer',
             percentPosition: true
           });

           $grid.imagesLoaded().progress( function() {
              $grid.masonry('layout');
           });
         }, 700); // setTimeout

         $('.pictures-button').hover(
           function() {
             $(this).css("font-size", "20px");

           }, function() {
             $(this).css("font-size", "18px");

         });

         $('.texts-button').hover(
           function() {
             $(this).css("font-size", "20px");

           }, function() {
             $(this).css("font-size", "18px");

         });

         $('.videos-button').hover(
           function() {
             $(this).css("font-size", "20px");

           }, function() {
             $(this).css("font-size", "18px");

         });

   }); // Document Ready
</script>
